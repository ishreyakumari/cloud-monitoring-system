<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud Log Monitor</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 5px;
        }
        .subtitle {
            color: #666;
            font-size: 14px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }
        .stat-card .number {
            font-size: 32px;
            font-weight: bold;
        }
        .stat-card.total .number { color: #2196F3; }
        .stat-card.error .number { color: #f44336; }
        .stat-card.warning .number { color: #ff9800; }
        .stat-card.info .number { color: #4CAF50; }
        .content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }
        .logs-section, .chart-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .filter {
            margin-bottom: 15px;
        }
        select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #f5f5f5;
            font-weight: 600;
            color: #333;
        }
        .severity {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .severity.ERROR { background: #ffebee; color: #c62828; }
        .severity.WARNING { background: #fff3e0; color: #e65100; }
        .severity.INFO { background: #e8f5e9; color: #2e7d32; }
        .message {
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .time {
            font-size: 12px;
            color: #666;
        }
        .chart-container {
            position: relative;
            height: 300px;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Cloud Log Monitoring System</h1>
        <p class="subtitle">Team: Shreya Kumari (fd6317), Richa Sapre (ee9498)</p>
    </div>

    <div class="stats">
        <div class="stat-card total">
            <h3>Total Logs</h3>
            <div class="number" id="totalLogs">0</div>
        </div>
        <div class="stat-card error">
            <h3>Errors</h3>
            <div class="number" id="errorCount">0</div>
        </div>
        <div class="stat-card warning">
            <h3>Warnings</h3>
            <div class="number" id="warningCount">0</div>
        </div>
        <div class="stat-card info">
            <h3>Info</h3>
            <div class="number" id="infoCount">0</div>
        </div>
    </div>

    <div class="content">
        <div class="logs-section">
            <h2>Recent Logs</h2>
            <div class="filter">
                <label>Filter by severity: </label>
                <select id="severityFilter" onchange="filterLogs()">
                    <option value="">All</option>
                    <option value="ERROR">Error</option>
                    <option value="WARNING">Warning</option>
                    <option value="INFO">Info</option>
                </select>
            </div>
            <div id="logsTable"></div>
        </div>

        <div class="chart-section">
            <h2>Log Distribution</h2>
            <div class="chart-container">
                <canvas id="logChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8080';
        let allLogs = [];
        let chart = null;

        // Initialize chart
        function initChart() {
            const ctx = document.getElementById('logChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ERROR', 'WARNING', 'INFO'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: ['#f44336', '#ff9800', '#4CAF50']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Fetch stats
        async function fetchStats() {
            try {
                const response = await fetch(`${API_URL}/api/stats`);
                const data = await response.json();
                
                document.getElementById('totalLogs').textContent = data.total;
                document.getElementById('errorCount').textContent = data.distribution.ERROR;
                document.getElementById('warningCount').textContent = data.distribution.WARNING;
                document.getElementById('infoCount').textContent = data.distribution.INFO;
                
                if (chart) {
                    chart.data.datasets[0].data = [
                        data.distribution.ERROR,
                        data.distribution.WARNING,
                        data.distribution.INFO
                    ];
                    chart.update();
                }
            } catch (error) {
                console.error('Error fetching stats:', error);
            }
        }

        // Fetch logs
        async function fetchLogs() {
            try {
                const response = await fetch(`${API_URL}/api/logs?limit=50`);
                const data = await response.json();
                allLogs = data.logs;
                displayLogs(allLogs);
            } catch (error) {
                console.error('Error fetching logs:', error);
                document.getElementById('logsTable').innerHTML = 
                    '<div class="loading">Error loading logs. Make sure the API is running on port 8080.</div>';
            }
        }

        // Display logs
        function displayLogs(logs) {
            if (logs.length === 0) {
                document.getElementById('logsTable').innerHTML = 
                    '<div class="loading">No logs found</div>';
                return;
            }

            let html = '<table><thead><tr><th>Severity</th><th>Message</th><th>Time</th></tr></thead><tbody>';
            
            logs.forEach(log => {
                const time = log.timestamp ? new Date(log.timestamp).toLocaleString() : 'N/A';
                html += `
                    <tr>
                        <td><span class="severity ${log.severity}">${log.severity}</span></td>
                        <td><div class="message" title="${log.message}">${log.message}</div></td>
                        <td class="time">${time}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            document.getElementById('logsTable').innerHTML = html;
        }

        // Filter logs
        function filterLogs() {
            const severity = document.getElementById('severityFilter').value;
            if (severity === '') {
                displayLogs(allLogs);
            } else {
                const filtered = allLogs.filter(log => log.severity === severity);
                displayLogs(filtered);
            }
        }

        // Auto refresh
        function startAutoRefresh() {
            fetchStats();
            fetchLogs();
            setInterval(() => {
                fetchStats();
                fetchLogs();
            }, 10000); // Refresh every 10 seconds
        }

        // Initialize
        window.onload = () => {
            initChart();
            startAutoRefresh();
        };
    </script>
</body>
</html>
